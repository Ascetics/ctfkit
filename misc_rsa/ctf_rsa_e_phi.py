# -*- coding:utf8 -*-
"""
e 和 φ(n) 并不是互素的，也就是不满足gcd(e, φ(n))=1
这里核心的地方在于gcd(e, φ(n))=cf, m^cf 看成是明文，再开cf次幂
"""

import gmpy2
from Crypto.Util.number import long_to_bytes

p = 127346657296966281106854437915566302489035503867209365225464769149364916377649221715644868274969994830021907816536487697037927326669343680817626394628059416307748180509310043959788901776350444278302482572396137760355783028754164111470736033566039120671153208213406728174032320506182380397712402112249416727049
q = 129977522448127985502705135499093758554580803715308992038245139386359526040024981890138010442056823626833608528616652270823127997752903965259510395345535370421708668844593013515811795302231375948724888614600926562868789102880383644712522614357869135221109093902359980800725961683056681691225107119917162111601
e = 498
c = 3191077469066624394578722760655452830413317443932682147378077493651775225542567292121865824956615312277999864765565827995547623582566288394295434817283964215640835363991958352773714052513924940770391587810823272280972154385354186450034042838269763305748144425049076693725170392807170301916734625545526849972706682913921819954213685592148917132794978837982154582529934249549309184927971219477563709516944754956476078539105318141913368813639297354242808182291604352435520129250525943217095451583607906042318148800977086383632916208828781189020367474557726793718384861576249133264239511866972761006093635745864791467673

phi_n = (p - 1) * (q - 1)

cf = gmpy2.gcd(e, phi_n)
print('gcd(e, phi_n)={:d}'.format(cf))

d = gmpy2.invert(e // cf, phi_n)
d = int(d)
n = p * q
m_cf = pow(c, d, n)
print('m^gcd(e, phi_n)={:d}'.format(m_cf))

m = gmpy2.iroot(m_cf, cf)
m = int(m[0])
print('m={:d}'.format(m))

m = long_to_bytes(m)
m = str(m, 'utf-8')
print(m)
